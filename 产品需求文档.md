# Windows本地文件管理系统 - 产品需求文档

## 1. 项目概述

### 1.1 项目背景
用户需要管理Windows系统上的大量文件，希望通过标签(tag)系统对文件进行智能分类和快速检索。系统需要具备文件移动/修改后的自动识别能力，确保标签与文件的关联关系持久有效。

### 1.2 核心价值
- **智能文件管理**：通过标签系统替代传统文件夹分类
- **快速精准检索**：基于标签的快速文件查找和定位
- **持久关联**：文件移动或修改后仍能保持标签关联
- **本地化运行**：数据存储在本地，保护隐私和安全

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 文件标签管理
- 支持为单个文件添加多个标签
- 标签支持层级结构（如：项目/子标签）
- 标签支持颜色标记和图标
- 批量文件标签操作

#### 2.1.2 智能文件识别
- 文件指纹生成（基于内容哈希、元数据等）
- 文件移动/重命名后的自动识别
- 文件内容修改后的版本追踪
- 文件删除后的标签保留（可选恢复）

#### 2.1.3 搜索与检索
- 标签组合搜索（AND/OR逻辑）
- 模糊标签匹配
- 文件属性筛选（类型、大小、修改时间）
- 搜索结果快速预览和跳转

#### 2.1.4 文件操作
- 通过标签快速定位并打开文件
- 基于标签的文件批量操作
- 文件快速复制/移动到指定位置
- 文件链接创建（快捷方式）

### 2.2 辅助功能

#### 2.2.1 标签管理
- 标签库管理（创建、编辑、删除、合并）
- 标签使用统计
- 标签智能推荐
- 标签导入/导出

#### 2.2.2 系统监控
- 文件系统变更监控（实时/定时）
- 文件关联状态检查
- 数据库完整性验证
- 系统性能监控

#### 2.2.3 数据管理
- 数据库备份/恢复
- 标签数据导出（JSON/CSV）
- 系统设置管理
- 使用日志记录

## 3. 非功能需求

### 3.1 性能要求
- 文件索引速度：1000文件/分钟
- 标签搜索响应时间：< 1秒（10万文件规模）
- 系统启动时间：< 3秒
- 内存占用：< 200MB

### 3.2 可靠性要求
- 文件关联准确率：> 99.9%
- 数据丢失容忍度：0%
- 系统崩溃恢复：自动恢复
- 数据库损坏修复：内置修复工具

### 3.3 兼容性要求
- Windows 10/11 64位系统
- NTFS/FAT32/exFAT文件系统
- 支持中文路径和文件名
- 支持长路径（> 260字符）

### 3.4 安全性要求
- 本地数据加密存储
- 用户权限控制（可选）
- 敏感文件标记和隐藏
- 操作日志审计

## 4. 技术架构设计

### 4.1 系统架构
```
┌─────────────────────────────────────────┐
│             用户界面层                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │ 主窗口  │  │ 搜索框  │  │ 标签面板 │ │
│  └─────────┘  └─────────┘  └─────────┘ │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│             业务逻辑层                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │文件监控 │  │标签管理 │  │搜索引擎 │ │
│  └─────────┘  └─────────┘  └─────────┘ │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│             数据访问层                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │文件索引 │  │标签数据库│  │配置管理 │ │
│  └─────────┘  └─────────┘  └─────────┘ │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│             系统接口层                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │文件系统 │  │系统通知 │  │注册表   │ │
│  └─────────┘  └─────────┘  └─────────┘ │
└─────────────────────────────────────────┘
```

### 4.2 数据模型

#### 4.2.1 文件表 (files)
```sql
CREATE TABLE files (
    id INTEGER PRIMARY KEY,
    file_hash TEXT NOT NULL,          -- 文件内容哈希
    path_hash TEXT NOT NULL,          -- 路径哈希（用于快速查找）
    original_path TEXT,               -- 原始路径（历史记录）
    current_path TEXT NOT NULL,       -- 当前路径
    file_name TEXT NOT NULL,
    file_size INTEGER,
    file_type TEXT,
    created_time DATETIME,
    modified_time DATETIME,
    last_seen_time DATETIME,
    fingerprint_data BLOB,            -- 文件指纹数据
    is_active BOOLEAN DEFAULT 1
);
```

#### 4.2.2 标签表 (tags)
```sql
CREATE TABLE tags (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    color TEXT,
    icon TEXT,
    parent_id INTEGER,
    description TEXT,
    created_time DATETIME,
    usage_count INTEGER DEFAULT 0
);
```

#### 4.2.3 文件-标签关联表 (file_tags)
```sql
CREATE TABLE file_tags (
    file_id INTEGER NOT NULL,
    tag_id INTEGER NOT NULL,
    added_time DATETIME,
    added_by TEXT,
    confidence REAL DEFAULT 1.0,      -- 关联置信度
    PRIMARY KEY (file_id, tag_id),
    FOREIGN KEY (file_id) REFERENCES files(id),
    FOREIGN KEY (tag_id) REFERENCES tags(id)
);
```

#### 4.2.4 文件变更历史表 (file_changes)
```sql
CREATE TABLE file_changes (
    id INTEGER PRIMARY KEY,
    file_id INTEGER NOT NULL,
    change_type TEXT,                 -- MOVE, RENAME, MODIFY, DELETE
    old_path TEXT,
    new_path TEXT,
    old_hash TEXT,
    new_hash TEXT,
    change_time DATETIME,
    detected_time DATETIME,
    FOREIGN KEY (file_id) REFERENCES files(id)
);
```

## 5. 关键技术方案

### 5.1 文件识别技术

#### 5.1.1 文件指纹生成
- **内容哈希**：SHA-256（文件内容）
- **元数据指纹**：文件名、大小、创建时间、修改时间
- **混合指纹**：内容哈希 + 关键元数据
- **增量指纹**：大文件的抽样哈希

#### 5.1.2 文件变更检测
- **实时监控**：Windows文件系统监控API
- **定时扫描**：后台任务定期验证
- **变更识别算法**：
  1. 路径变更检测
  2. 内容哈希比对
  3. 元数据变化分析
  4. 相似度匹配（容错处理）

### 5.2 搜索技术

#### 5.2.1 标签搜索
- 倒排索引（标签->文件列表）
- 布尔逻辑搜索（AND/OR/NOT）
- 模糊匹配（前缀、后缀、包含）
- 相关性排序（使用频率、时间）

#### 5.2.2 混合搜索
- 标签 + 文件名组合搜索
- 标签 + 文件属性筛选
- 历史搜索记录和智能推荐

### 5.3 数据同步机制

#### 5.3.1 文件系统同步
- 初始全量扫描
- 增量变更捕获
- 冲突检测和解决
- 后台同步任务

#### 5.3.2 数据库优化
- 索引优化（文件哈希、路径哈希）
- 查询缓存
- 批量操作事务
- 定期数据清理

## 6. 用户界面设计

### 6.1 主界面布局
```
┌─────────────────────────────────────────────────────┐
│ 菜单栏 [文件 编辑 视图 标签 工具 帮助]               │
├─────────────────────────────────────────────────────┤
│ 搜索框 [🔍 输入标签或文件名...]      [高级搜索]      │
├──────────────┬──────────────────────────────────────┤
│              │                                      │
│  标签面板    │          文件列表区域                 │
│  ┌────────┐  │  ┌────────────────────────────────┐  │
│  │ 📁 项目 │  │  │ 文件名        标签      大小   │  │
│  │   ├─ 📁 │  │  ├────────────────────────────────┤  │
│  │   │  子项│  │  │ document.docx 项目A    1.2MB  │  │
│  │   └─ 📁 │  │  │ image.jpg     项目A,B  4.5MB  │  │
│  │ 📁 工作 │  │  │ report.pdf    工作     2.8MB  │  │
│  │ 📁 个人 │  │  └────────────────────────────────┘  │
│  └────────┘  │                                      │
│              │          文件预览区域                 │
│              │  ┌────────────────────────────────┐  │
│              │  │ 预览内容或文件信息              │  │
│              │  └────────────────────────────────┘  │
└──────────────┴──────────────────────────────────────┘
```

### 6.2 关键交互
- **拖拽标签**：拖拽标签到文件进行标记
- **右键菜单**：文件/标签的上下文操作
- **快捷键**：常用操作的键盘快捷键
- **系统托盘**：后台运行和快速访问

## 7. 开发计划

### 7.1 第一阶段：核心功能（4-6周）
1. 数据库设计和实现
2. 文件指纹生成和识别
3. 基础标签管理
4. 简单搜索功能

### 7.2 第二阶段：完善功能（3-4周）
1. 文件系统监控
2. 高级搜索功能
3. 批量操作支持
4. 用户界面优化

### 7.3 第三阶段：高级功能（2-3周）
1. 智能标签推荐
2. 数据备份恢复
3. 性能优化
4. 系统测试

## 8. 风险评估

### 8.1 技术风险
- 文件系统监控性能影响
- 大文件指纹生成效率
- 数据库并发访问冲突
- Windows系统兼容性问题

### 8.2 数据风险
- 文件关联丢失
- 数据库损坏
- 标签数据不一致
- 系统迁移困难

### 8.3 缓解措施
- 定期数据库备份
- 文件关联验证机制
- 性能监控和优化
- 用户数据导出功能

## 9. 成功指标

### 9.1 功能指标
- 文件识别准确率 > 99%
- 标签搜索响应时间 < 1秒
- 系统资源占用 < 系统资源的5%
- 用户操作满意度 > 4.5/5

### 9.2 使用指标
- 日均标签使用次数 > 50
- 文件检索成功率 > 95%
- 用户留存率 > 80%
- 系统稳定性 > 99.5%

---
*文档版本：v1.0*
*创建日期：2025-12-05*
*最后更新：2025-12-05*